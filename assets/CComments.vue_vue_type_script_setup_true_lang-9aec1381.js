import{w as B,N as v,c as f,d as P}from"./loading-8758b90e.js";import{C as L}from"./COver-ad4c1e72.js";import{d as V,a as w,p as q,a6 as r,a9 as u,a8 as a,a4 as t,ad as n,ae as _,af as e,ag as m,a7 as b,F as N,ak as D,ac as F,al as I,bd as O,be as T}from"./index-f2d47f63.js";import{C as $}from"./CMarkdown-bb6f50f1.js";import{N as A,_ as E}from"./CReactions.vue_vue_type_script_setup_true_lang-6c2b3023.js";import{a as M}from"../app.config.js";import{N as d}from"./Card-27a8e976.js";const j=["href"],G={class:"flex"},H=["href"],J=["src"],K=["href"],Q={class:"font-bold text-xl hover:text-green-300"},R={class:"text-center"},U={key:1,class:"text-center"},S=10,se=V({__name:"CComments",props:{issue:{},name:{}},setup(z){const h=z,o=w([]),c=B({state:"init",fail:"评论查询失败!"}),k=w(!1);let p=1;const C=q(()=>T(h.issue.labels,M.label.hiddenCommentLabel));async function x(l,i){if(C.value)return;c.value="loading";const[s,g]=await I(O.qCommentsByIssueId(l,{page:i.toString(),per_page:S.toString()}));if(s){c.value="fail";return}(g.length==0||g.length<S)&&(k.value=!0),o.value.push(...g),c.value="success"}x(h.issue.number.toString(),p);function y(){const l=o.value.length,i=l==0?1:p+1;x(h.issue.number.toString(),i).then(()=>{l!=o.value.length&&(p+=i)})}return(l,i)=>(r(),u(e(f),{vertical:""},{default:a(()=>[t(e(d),{class:"font-bold",size:"small",bordered:!1},{default:a(()=>[n("p",null,_(l.name)+":",1)]),_:1}),C.value?(r(),u(e(d),{key:0,class:"font-bold p-2 text-center",size:"small",bordered:!1},{default:a(()=>[m(_(l.name)+"已影藏 ",1)]),_:1})):(r(),b(N,{key:1},[t(e(d),{size:"small",bordered:!1},{default:a(()=>[n("a",{href:l.issue.html_url,target:"_blank"},[t(e(v),{class:"w-full",type:"info"},{default:a(()=>[m("去"+_(l.name),1)]),_:1})],8,j)]),_:1}),o.value.length>0?(r(),u(e(f),{key:0,vertical:""},{default:a(()=>[(r(!0),b(N,null,D(o.value,s=>(r(),u(e(d),{size:"small",key:s.id,bordered:!1},{default:a(()=>[n("div",G,[n("a",{target:"_blank",href:s.user.html_url},[n("img",{src:s.user.avatar_url,class:"rounded-md block w-16 h-16 flex-shrink-0 hover:scale-105 duration-100"},null,8,J)],8,H),t(e(f),{vertical:"",class:"ml-2 flex-grow w-0"},{default:a(()=>[n("a",{target:"_blank",href:s.user.html_url},[n("span",Q,_(s.user.login),1)],8,K),t(e(f),{align:"center"},{default:a(()=>[t(e(A),{time:new Date(s.updated_at),type:"relative"},null,8,["time"]),t(E,{class:"inline-block",reactions:s.reactions},null,8,["reactions"])]),_:2},1024),t(e(d),{bordered:!1,size:"small",class:"w-full overflow-hidden"},{default:a(()=>[t($,{text:s.body,class:"rounded-lg",id:s.id},null,8,["text","id"])]),_:2},1024)]),_:2},1024)])]),_:2},1024))),128))]),_:1})):F("",!0),t(e(P),{state:e(c)},{fail:a(()=>[n("div",R,[t(e(v),{onClick:y,class:"mx-auto"},{default:a(()=>[m(" 重试 ")]),_:1})])]),default:a(()=>[k.value?(r(),u(e(L),{key:0})):(r(),b("div",U,[t(e(v),{onClick:y,class:"mx-auto"},{default:a(()=>[m(" 更多 ")]),_:1})]))]),_:1},8,["state"])],64))]),_:1}))}});export{se as _};
